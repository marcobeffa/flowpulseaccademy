<!-- users/change_passwords/edit.html.erb -->
<div class="max-w-3xl mx-auto">
  <!-- Tabs + Logout -->
  <div class="flex items-center justify-between mb-6">
    <div class="inline-flex rounded-xl bg-slate-100 p-1">
      <%= link_to "Profilo",
          edit_account_path,
          class: "px-4 py-2 text-sm font-medium rounded-lg #{current_page?(edit_account_path) ? 'bg-white shadow text-slate-900' : 'text-slate-600 hover:text-slate-900'}" %>
      <%= link_to "Password",
          edit_change_passwords_path,
          class: "px-4 py-2 text-sm font-medium rounded-lg #{current_page?(edit_change_passwords_path) ? 'bg-white shadow text-slate-900' : 'text-slate-600 hover:text-slate-900'}" %>
    </div>
    <%= button_to "Esci",
        session_path,
        method: :delete,
        form: { data: { turbo_confirm: "Confermi il logout?" } },
        class: "inline-flex items-center rounded-lg bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow hover:bg-red-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600" %>
  </div>
  <div class="rounded-2xl bg-white p-6 shadow">
    <h1 class="text-xl font-semibold text-slate-900 mb-4">Cambia Password</h1>
    <%= form_with model: Current.user, url: change_passwords_path, method: :patch, local: true, class: "space-y-8" do |f| %>
      <%# Mostra errori sul model se l'update fallisce %>
      <% if Current.user.errors.any? %>
        <div class="rounded-xl border border-red-200 bg-red-50 p-4">
          <p class="font-semibold text-red-800">
            Ci sono <%= pluralize(Current.user.errors.count, "errore") %> nel form:
          </p>
          <ul class="mt-2 list-disc pl-5 text-sm text-red-700">
            <% Current.user.errors.full_messages.each do |m| %>
              <li><%= m %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
      <div>
        <%= label_tag :current_password, "Password attuale", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= password_field_tag "user[current_password]", nil, autocomplete: "current-password",
              class: "w-full rounded-lg border-2 border-gray-200 bg-gray-50 px-4 py-3 focus:border-blue-500 focus:bg-white focus:outline-none" %>
      </div>
      <div class="grid gap-6 md:grid-cols-2">
        <div>
          <%= f.label :password, "Nuova password", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= f.password_field :password, autocomplete: "new-password",
                class: "w-full rounded-lg border-2 border-gray-200 bg-gray-50 px-4 py-3 focus:border-blue-500 focus:bg-white focus:outline-none" %>
        </div>
        <div>
          <%= f.label :password_confirmation, "Conferma nuova password", class: "block text-sm font-semibold text-gray-700 mb-2" %>
          <%= f.password_field :password_confirmation, autocomplete: "new-password",
                class: "w-full rounded-lg border-2 border-gray-200 bg-gray-50 px-4 py-3 focus:border-blue-500 focus:bg-white focus:outline-none" %>
        </div>
      </div>
      <div class="pt-2">
        <%= f.submit "Aggiorna password",
            class: "rounded-full bg-blue-600 px-8 py-3 font-semibold text-white shadow hover:bg-blue-700" %>
      </div>
    <% end %>
  </div>
</div>
